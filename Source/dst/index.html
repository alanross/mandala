<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="Mandala">
    <meta name="author" content="Alan Ross (me ~at~ aross.io)">
    <title>Mandala</title>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <style type="text/css">
        html, body {
            width:100%;
            height:100%;
            margin:0;
            border:0;
            overflow:hidden;
            display:block;
            background:#000;
            cursor:default;
        }

        #container * {
            cursor:default !important;
        }

        #buttons {
            position:absolute;
            width:160px;
            height:30px;
            bottom:30px;
            right:30px;
            text-align:right;
        }

        #buttons div {
            position:relative;
            display:inline-block;
            margin:0 0 0 10px;
        }

        #buttons i {
            margin:0;
            border:1px solid #999;
            background:#000;
            color:#999;
            width:16px;
            height:16px;
            border-radius:50%;
            text-align:center;
            line-height:16px;
            vertical-align:middle;
            padding:3px;
            cursor:pointer;
            font-size:0.75em;
        }
    </style>

    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
</head>
<body>
<div id="container"></div>
<div id="buttons">
    <div><i class="fa fa-picture-o" data-action="image"></i></div>
    <div><i class="fa fa-share" data-action="share"></i></div>
    <div><i class="fa fa-play" data-action="play"></i></div>
    <div><i class="fa fa-trash" data-action="trash"></i></div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>function lzwEncode(t){for(var n,e={},a=(t+"").split(""),i=[],o=a[0],r=256,s=1;s<a.length;s++)n=a[s],null!=e[o+n]?o+=n:(i.push(o.length>1?e[o]:o.charCodeAt(0)),e[o+n]=r,r++,o=n);i.push(o.length>1?e[o]:o.charCodeAt(0));for(var s=0;s<i.length;s++)i[s]=String.fromCharCode(i[s]);return i.join("")}function lzwDecode(t){for(var n,e={},a=(t+"").split(""),i=a[0],o=i,r=[i],s=256,c=1;c<a.length;c++){var l=a[c].charCodeAt(0);n=256>l?a[c]:e[l]?e[l]:o+i,r.push(n),i=n.charAt(0),e[s]=o+i,s++,o=n}return r.join("")}!function(){for(var t=0,n=["ms","moz","webkit","o"],e=0;e<n.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"]||window[n[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var e=(new Date).getTime(),a=Math.max(0,16-(e-t)),i=window.setTimeout(function(){n(e+a)},a);return t=e+a,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var RamerDouglasPeucker=function(){function t(t,n){var e=t.x-n.x,a=t.y-n.y;return e*e+a*a}function n(t,n,e){var a=n.x,i=n.y,o=e.x-a,r=e.y-i;if(0!==o||0!==r){var s=((t.x-a)*o+(t.y-i)*r)/(o*o+r*r);s>1?(a=e.x,i=e.y):s>0&&(a+=o*s,i+=r*s)}return o=t.x-a,r=t.y-i,o*o+r*r}function e(n,e){for(var a,i=n[0],o=[i],r=1,s=n.length;s>r;r++)a=n[r],t(a,i)>e&&(o.push(a),i=a);return i!==a&&o.push(a),o}function a(t,e,i,o,r){for(var s,c=o,l=e+1;i>l;l++){var h=n(t[l],t[e],t[i]);h>c&&(s=l,c=h)}c>o&&(s-e>1&&a(t,e,s,o,r),r.push(t[s]),i-s>1&&a(t,s,i,o,r))}function i(t,n){var e=t.length-1,i=[t[0]];return a(t,0,e,n,i),i.push(t[e]),i}this.process=function(t,n){if(t.length<=2)return t;var a=void 0!==n?n*n:1;return t=e(t,a),t=i(t,a)}};Mandala=function(t,n,e,a){function i(){D=new RamerDouglasPeucker,I=$("<canvas/>").css({position:"absolute",top:0,left:0}),S=$("<canvas/>").css({position:"absolute",top:0,left:0}),C=$(t).css({position:"absolute"}).append(I).append(S),I=I[0],S=S[0],C.mousedown(u).mouseup(h).mousemove(d),T=$(window),T.resize(g).keydown(v).dblclick(f),$(n).find("i").click(w),o(),p()}function o(){F=T.width(),k=T.height(),P=F>>1,R=k>>1,A=Math.max(F,k),J=[],X=[],C.css({top:0,left:0,width:F,height:k}),I.width=F,I.height=k,S.width=F,S.height=k,q=I.getContext("2d"),q.clearRect(0,0,F,k),N=S.getContext("2d"),N.clearRect(0,0,F,k),N.lineJoin="round",N.lineCap="round",r()}function r(){for(var t=0,n=360/z,e=25,a=Math.max(F,k),i=0;z>i;++i){q.save(),q.beginPath(),q.strokeStyle="#232323",q.lineWidth=1;var o=t*Math.PI/180;q.moveTo(P+e*Math.cos(o),R+e*Math.sin(o)),q.lineTo(P+a*Math.cos(o),R+a*Math.sin(o)),q.stroke(),q.restore(),t+=n}}function s(){if(N.clearRect(0,0,F,k),0!=J.length){var t=0,n=360/z,e=-1,a=n*Math.PI/180;if(N.strokeStyle=E,N.fillStyle=E,1==J.length)for(var i=J[0],o=0;z>o;++o){N.save(),N.beginPath(),N.lineWidth=i.wid,N.strokeStyle=E;var r=t*Math.PI/180+(e>0?a-i.ang:i.ang),s=P+i.dst*A*Math.cos(r),c=R+i.dst*A*Math.sin(r);N.lineWidth=i.wid,N.arc(s,c,.5*N.lineWidth,0,2*Math.PI,!1),N.fill(),N.closePath(),N.restore(),t+=n,e*=-1}else for(var o=0;z>o;++o){N.save(),N.strokeStyle=E,N.beginPath();var l=t*Math.PI/180,i=J[0],r=l+(e>0?a-i.ang:i.ang),h=P+i.dst*A*Math.cos(r),u=R+i.dst*A*Math.sin(r);N.lineWidth=i.wid,N.moveTo(h,u);for(var d=J.length-1,f=1;d>f;++f){i=J[f],r=l+(e>0?a-i.ang:i.ang);var w=P+i.dst*A*Math.cos(r),g=R+i.dst*A*Math.sin(r);N.quadraticCurveTo(h,u,.5*(h+w),.5*(u+g)),h=w,u=g}i=J[d],r=l+(e>0?a-i.ang:i.ang),w=P+i.dst*A*Math.cos(r),g=R+i.dst*A*Math.sin(r),N.quadraticCurveTo(h,u,w,g),N.stroke(),t+=n,e*=-1,N.restore()}U&&(U=!1,q.drawImage(S,0,0),N.clearRect(0,0,F,k),0==j&&(X=X.concat(J),X.push({end:!0})),J=[])}}function c(t){var n=t.currentTarget.getBoundingClientRect(),e={x:t.clientX-n.left,y:t.clientY-n.top};J.push(e),J=D.process(J,.9),J.push(e);for(var a=0;a<J.length;++a){var i=J[a],o=i.x-P,r=i.y-R;i.dst=(Math.sqrt(o*o+r*r)>>0)/A,i.dst=Math.floor(i.dst*W)/W,i.ang=Math.atan2(i.y-R,i.x-P),i.ang=Math.floor(i.ang*W)/W,i.wid=B}}function l(){window.requestAnimationFrame(s)}function h(t){L=!1,U=!0,c(t),l()}function u(t){L=!0,c(t),l()}function d(t){L&&(c(t),l())}function f(){o()}function w(t){var n=$(t.currentTarget).attr("data-action");switch(n){case"share":m();break;case"image":y();break;case"trash":o();break;case"play":x()}console.log($(t.currentTarget).attr("data-action"))}function g(){C.css({top:T.height()-k>>1,left:T.width()-F>>1})}function v(t){if(t.preventDefault(),!t.which)return!1;if(49<=t.which&&t.which<=57){var n=parseInt(t.which)-48;B=1>n?1:n>5?5:n,l()}return!1}function m(){for(var t="",n=0,e=X.length;e>n;++n){var a=X[n];t+=a.end?"|":a.dst*W+"."+a.ang*W+"."+a.wid+"."}t=t.replace(/\|$/,"").replace(/\.$/,""),window.prompt("Copy to clipboard: Ctrl+C, Enter",window.location.href+"?p="+t)}function p(){var t=M("p");if(t){X=[];for(var n=t.split("|"),e=0;e<n.length;++e){for(var a=n[e].split("."),i=0;i<a.length;i+=3){var o=parseInt(a[i]),r=parseInt(a[i+1]),s=parseInt(a[i+2]);isNaN(o)||isNaN(r)||isNaN(s)||X.push({dst:o/W,ang:r/W,wid:s})}X.push({end:!0})}x()}}function M(t){for(var n=window.location.search.substring(1).split("&"),e=0;e<n.length;e++){var a=n[e].split("=");if(a[0]==t)return a[1]}}function y(){var t=document.createElement("canvas");t.width=F,t.height=k;var n=t.getContext("2d");n.clearRect(0,0,F,k),n.beginPath(),n.fillStyle="#000",n.rect(0,0,F,k),n.fill(),n.drawImage(I,0,0),n.beginPath(),n.fillStyle="#000",n.rect(F-123,k-25,118,15),n.fill(),n.beginPath(),n.font="11px Arial",n.fillStyle="#fff",n.fillText("http://aross.io/mandala",F-120,k-15);var e=t.toDataURL("image/png"),a=window.open("about:blank","image from canvas");a.document.write("<span style='display:block; text-align:center'>Right click on image to save.</span><img src='"+e+"' alt='Exported from Mandala'/>")}function x(){J=[],Y=-1,j=!0,q.clearRect(0,0,F,k),N.clearRect(0,0,F,k),b()}function b(){if(j=!1,X.length>++Y){j=!0;var t=X[Y];t.end?(U=!0,s(),setTimeout(b,120)):(J.push(t),s(),setTimeout(b,60))}}var F,k,P,R,A,T,C,I,q,S,N,D,W=1e3,z=a||48,E=e||"#FFFFFF",B=2,J=[],L=!1,U=!1,X=[],Y=0,j=!1;i()},$(function(){new Mandala("#container","#buttons")});</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86956579-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>